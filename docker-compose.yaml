version: "3.6"
services:
  nginx:
    # Note : Only nginx:alpine supports bcrypt.
    # If you don't need to use bcrypt, you can use a different tag.
    # Ref. https://github.com/nginxinc/docker-nginx/issues/29
    image: "nginx:alpine"
    ports:
    - 80:80
    - 443:443
    volumes:
    - ./auth:/etc/nginx/conf.d
    - ./auth/nginx.conf:/etc/nginx/nginx.conf:ro
    restart: always
    container_name: nginx
    networks: 
    - registry
  docker-registry-frontend:
    image: "konradkleine/docker-registry-frontend:v2"
    ports:
    - 127.0.0.1:8080:80
    environment:
    - ENV_DOCKER_REGISTRY_HOST=registry
    - ENV_DOCKER_REGISTRY_PORT=5000
    - ENV_DOCKER_REGISTRY_USE_SSL=1
    - ENV_MODE_BROWSE_ONLY=false
    restart: always
    container_name: registry-frontend
    networks: 
    - registry
  registry:
    image: registry
    ports:
    - 127.0.0.1:5000:5000
    volumes:
    - ./registry:/var/lib/registry
    restart: always
    container_name: registry
    networks: 
    - registry
networks: 
  registry: 